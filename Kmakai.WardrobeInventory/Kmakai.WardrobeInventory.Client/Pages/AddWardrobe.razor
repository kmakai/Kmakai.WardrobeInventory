@page "/new-wardrobe"
@rendermode InteractiveWebAssembly
@inject HttpClient client

<h3>New wardrobe</h3>
<div class="d-flex flex-md-row flex-column ">
    <div class="d-flex flex-column p-4 gap-4">
        <div class="d-flex gap-2">
            <div class="border border-2 @(shirt != null ? "border-success" :  "border-danger") rounded-2" style="min-width: 100px; height: 100px; overflow: hidden;">
                <img src=@(shirt?.Image?.ImageUrl ?? "images/soutline.jpg") alt="Alternate Text" class="w-100 h-100" />
            </div>
            <div style="width:100px;" class="">
                Shirt
                <div class="d-flex flex-column">
                    <small>
                        @(shirt?.Name ?? "No shirt selected")
                    </small>
                    <small>
                        @(shirt?.Description ?? "")
                    </small><small>
                        @(shirt?.Color ?? "")
                    </small>

                </div>
            </div>
        </div>
        <div class="d-flex gap-2">
            <div class="border border-2 @(pants != null ? "border-success" :  "border-danger") rounded-2" style="min-width: 100px; height: 100px; overflow: hidden;">
                <img src=@(pants?.Image?.ImageUrl ?? "images/poutline.jpg") alt="Alternate Text" class="w-100 h-100" />
            </div>
            <div style="width:100px;" class="">
                Pants
                <div class="d-flex flex-column">
                    <small>
                        @(pants?.Name ?? "No pants selected")
                    </small>
                    <small>
                        @(pants?.Description ?? "")
                    </small><small>
                        @(pants?.Color ?? "")
                    </small>

                </div>
            </div>
        </div>
        <div class="d-flex gap-2">
            <div class="border border-2 @(shoes != null ? "border-success" :  "border-danger") rounded-2" style="min-width: 100px; height: 100px; overflow: hidden;">
                <img src=@(shoes?.Image?.ImageUrl ?? "images/shoutline.jpg") alt="Alternate Text" class="w-100 h-100" />
            </div>
            <div style="width:100px;" class="">
                Shoes
                <div class="d-flex flex-column">
                    <small>
                        @(shoes?.Name ?? "No shoes selected")
                    </small>
                    <small>
                        @(shoes?.Description ?? "")
                    </small><small>
                        @(shoes?.Color ?? "")
                    </small>

                </div>
            </div>
        </div>

        <div class="d-flex gap-2">
            <input type="text" class="form-control" placeholder="Wardrobe Name" @bind="wardrobeName" />
        </div>

        <div>
            <button class="btn btn-primary" disabled="@(shirt == null || pants == null || shoes == null)">Save</button>
            <button class="btn btn-secondary" @onclick="Reset">reset</button>

        </div>
    </div>


    <div class="p-4">
        <div style="width: 255px;" class="d-flex gap-2">
            <button class="btn btn-primary" @onclick="async () => wardrobeItems = await GetItems()">All</button>
            <button class="btn btn-primary" @onclick="async () => wardrobeItems = await GetFilteredItems(ItemType.Top)">shirts</button>
            <button class="btn btn-primary" @onclick="async () => wardrobeItems = await GetFilteredItems(ItemType.Bottom)">pants</button>
            <button class="btn btn-primary" @onclick="async () => wardrobeItems = await GetFilteredItems(ItemType.Footwear)">Shoes</button>
        </div>

        <div class="d-flex flex-wrap gap-2 pt-2">


            @foreach (var item in wardrobeItems!)
            {

                <ItemCard Item="@item" Clicked="HandleClick" />
            }
        </div>

    </div>


</div>

@code {

    private List<WardrobeItem>? wardrobeItems = new List<WardrobeItem>();
    private WardrobeItem shirt { get; set; } = null!;
    private WardrobeItem pants { get; set; } = null!;
    private WardrobeItem shoes { get; set; } = null!;
    private Wardrobe newWardrobe { get; set; } = null!;
    private string wardrobeName { get; set; } = "";

    protected override async Task OnInitializedAsync()
    {
        wardrobeItems = await GetItems();
    }

    private async Task<List<WardrobeItem>?> GetItems()
    {
        return await client.GetFromJsonAsync<List<WardrobeItem>>("https://localhost:7103/api/wardrobe/items");
    }

    private void HandleClick(WardrobeItem item)
    {
        switch (item.ItemType)
        {
            case ItemType.Top:
                shirt = item;
                break;
            case ItemType.Bottom:
                pants = item;
                break;
            case ItemType.Footwear:
                shoes = item;
                break;
        }
    }

    private void Reset()
    {
        shirt = null!;
        pants = null!;
        shoes = null!;
    }

    private async Task<List<WardrobeItem>> GetFilteredItems(ItemType type)
    {
        var Items = await GetItems();
        return Items!.Where(x => x.ItemType == type).ToList();
    }

    private async Task Save()
    {
        newWardrobe = new Wardrobe
        {
            Name = wardrobeName,
            Items = new List<WardrobeItem> { shirt, pants, shoes }
        };

        await client.PostAsJsonAsync("https://localhost:7103/api/wardrobe", newWardrobe);
    }


}
